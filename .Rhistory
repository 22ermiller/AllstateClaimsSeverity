grades <- c(90.5, 78.9, 92.5, 75.7, 59.5, 79.6, 76.3, 86.2)
mu = 80
gamma <- 2.04
phi <- 104
gamma_2 <- gamma + (length(grades)/2)
phi_2 <- phi + (sum((grades-80)^2)/2)
curve(dinvgamma(x, gamma_2, phi_2), xlim=c(0, 5), xlab=expression(sigma^2), ylab="Density", main="Posterior distribution of variance of milk weight", n=1000)
curve(dinvgamma(x, gamma, phi), lty=2, add=T)
legend("topright", c("Posterior", "Prior"), lty=c(1,2))
curve(dinvgamma(x, gamma_2, phi_2), xlim=c(0, 50), xlab=expression(sigma^2), ylab="Density", main="Posterior distribution of variance of milk weight", n=1000)
curve(dinvgamma(x, gamma, phi), lty=2, add=T)
legend("topright", c("Posterior", "Prior"), lty=c(1,2))
curve(dinvgamma(x, gamma_2, phi_2), xlim=c(0, 100), xlab=expression(sigma^2), ylab="Density", main="Posterior distribution of variance of milk weight", n=1000)
curve(dinvgamma(x, gamma, phi), lty=2, add=T)
legend("topright", c("Posterior", "Prior"), lty=c(1,2))
curve(dinvgamma(x, gamma_2, phi_2), xlim=c(0, 200), xlab=expression(sigma^2), ylab="Density", main="Posterior distribution of variance of milk weight", n=1000)
curve(dinvgamma(x, gamma, phi), lty=2, add=T)
legend("topright", c("Posterior", "Prior"), lty=c(1,2))
curve(dinvgamma(x, gamma_2, phi_2), xlim=c(0, 300), xlab=expression(sigma^2), ylab="Density", main="Posterior distribution of variance of milk weight", n=1000)
curve(dinvgamma(x, gamma, phi), lty=2, add=T)
legend("topright", c("Posterior", "Prior"), lty=c(1,2))
grades <- c(90.5, 78.9, 92.5, 75.7, 59.5, 79.6, 76.3, 86.2)
mu = 80
gamma <- 2.04
phi <- 104
gamma_2 <- gamma + (length(grades)/2)
phi_2 <- phi + (sum((grades-mu)^2)/2)
curve(dinvgamma(x, gamma_2, phi_2), xlim=c(0, 300), xlab=expression(sigma^2), ylab="Density", main="Posterior distribution of variance of milk weight", n=1000)
curve(dinvgamma(x, gamma, phi), lty=2, add=T)
legend("topright", c("Posterior", "Prior"), lty=c(1,2))
100*100
10000/500
21*100
grades <- c(90.5, 78.9, 92.5, 75.7, 59.5, 79.6, 76.3, 86.2)
mu = 80
gamma <- 22
phi <- 2100
gamma_2 <- gamma + (length(grades)/2)
phi_2 <- phi + (sum((grades-mu)^2)/2)
curve(dinvgamma(x, gamma_2, phi_2), xlim=c(0, 300), xlab=expression(sigma^2), ylab="Density", main="Posterior distribution of variance of milk weight", n=1000)
curve(dinvgamma(x, gamma, phi), lty=2, add=T)
legend("topright", c("Posterior", "Prior"), lty=c(1,2))
lower <- sqrt(qinvgamma(.025, gamma_2, phi_2))
upper <- sqrt(qinvgamma(.975, gamma_2, phi_2))
sigmas <- sqrt(rinvgamma(1000, gamma_2, phi_2))
x <- rnorm(1000, rep(80,1000), sigmas)
hist(x)
mean(x > 90)
sigmas <- sqrt(rinvgamma(1000, gamma_2, phi_2))
x <- rnorm(1000, rep(80,1000), sigmas)
mean(x > 90)
data <- c(1010,1000,950,1050)
lambda <- 1000
tau <- 200
sigma <- 40
lambda_2 <- ((tau^2*sum(data))+(sigma^2*lambda))/((tau^2*length(data))+sigma^2)
tau_2 <- sqrt((sigma^2*tau^2)/((tau^2*length(data))+sigma^2))
100000/250000
grades <- c(90.5, 78.9, 92.5, 75.7, 59.5, 79.6, 76.3, 86.2)
mu = 80
gamma <- 2.04
phi <- 104
gamma_2 <- gamma + (length(grades)/2)
phi_2 <- phi + (sum((grades-mu)^2)/2)
curve(dinvgamma(x, gamma_2, phi_2), xlim=c(0, 300), xlab=expression(sigma^2), ylab="Density", main="Posterior distribution of variance of milk weight", n=1000)
curve(dinvgamma(x, gamma, phi), lty=2, add=T)
legend("topright", c("Posterior", "Prior"), lty=c(1,2))
lower <- sqrt(qinvgamma(.025, gamma_2, phi_2))
upper <- sqrt(qinvgamma(.975, gamma_2, phi_2))
grades <- c(90.5, 78.9, 92.5, 75.7, 59.5, 79.6, 76.3, 86.2)
mu = 80
gamma <- 2.04
phi <- 104
gamma_2 <- gamma + (length(grades)/2)
phi_2 <- phi + (sum((grades-mu)^2)/2)
curve(dinvgamma(x, gamma_2, phi_2), xlim=c(0, 300), xlab=expression(sigma^2), ylab="Density", main="Posterior distribution of variance of milk weight", n=1000)
curve(dinvgamma(x, gamma, phi), lty=2, add=T)
legend("topright", c("Posterior", "Prior"), lty=c(1,2))
lower <- sqrt(qinvgamma(.025, gamma_2, phi_2))
upper <- sqrt(qinvgamma(.975, gamma_2, phi_2))
sigmas <- sqrt(rinvgamma(1000, gamma_2, phi_2))
x <- rnorm(1000, rep(80,1000), sigmas)
mean(x > 90)
sigmas <- sqrt(rinvgamma(1000, gamma_2, phi_2))
x <- rnorm(1000, rep(80,1000), sigmas)
mean(x > 90)
sigmas <- sqrt(rinvgamma(1000, gamma_2, phi_2))
x <- rnorm(1000, rep(80,1000), sigmas)
mean(x > 90)
sigmas <- sqrt(rinvgamma(1000, gamma_2, phi_2))
x <- rnorm(1000, rep(80,1000), sigmas)
mean(x > 90)
sigmas <- sqrt(rinvgamma(1000, gamma_2, phi_2))
x <- rnorm(1000, rep(80,1000), sigmas)
mean(x > 90)
sigmas <- sqrt(rinvgamma(1000, gamma_2, phi_2))
x <- rnorm(1000, rep(80,1000), sigmas)
mean(x > 90)
sigmas <- sqrt(rinvgamma(1000, gamma_2, phi_2))
x <- rnorm(1000, rep(80,1000), sigmas)
mean(x > 90)
sigmas <- sqrt(rinvgamma(1000, gamma_2, phi_2))
x <- rnorm(1000, rep(80,1000), sigmas)
mean(x > 90)
sigmas <- sqrt(rinvgamma(1000, gamma_2, phi_2))
x <- rnorm(1000, rep(80,1000), sigmas)
mean(x > 90)
sigmas <- sqrt(rinvgamma(10000, gamma_2, phi_2))
x <- rnorm(10000, rep(80,10000), sigmas)
mean(x > 90)
sigmas <- sqrt(rinvgamma(10000, gamma_2, phi_2))
x <- rnorm(10000, rep(80,10000), sigmas)
mean(x > 90)
sigmas <- sqrt(rinvgamma(10000, gamma_2, phi_2))
x <- rnorm(10000, rep(80,10000), sigmas)
mean(x > 90)
sigmas <- sqrt(rinvgamma(10000, gamma_2, phi_2))
x <- rnorm(10000, rep(80,10000), sigmas)
mean(x > 90)
sigmas <- sqrt(rinvgamma(10000, gamma_2, phi_2))
x <- rnorm(10000, rep(80,10000), sigmas)
mean(x > 90)
sigmas <- sqrt(rinvgamma(10000, gamma_2, phi_2))
x <- rnorm(10000, rep(80,10000), sigmas)
mean(x > 90)
sigmas <- sqrt(rinvgamma(10000, gamma_2, phi_2))
x <- rnorm(10000, rep(80,10000), sigmas)
mean(x > 90)
sigmas <- sqrt(rinvgamma(10000, gamma_2, phi_2))
x <- rnorm(10000, rep(80,10000), sigmas)
mean(x > 90)
(4^5)/5
4^5
1023*8
3^5
243*4
.02/6
.00001167/1.05
(.02/6)^2
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(invgamma)
x <- seq(0,5, by = .001)
y <- pgamma(x, 2, .5)
ggplot() +
geom_line(aes(x = x, y = y))
x <- seq(0,300, by = .001)
y <- pgamma(x, 2, .5)
ggplot() +
geom_line(aes(x = x, y = y))
x <- seq(0,300, by = .001)
y <- dgamma(x, 2, .5)
ggplot() +
geom_line(aes(x = x, y = y))
x <- seq(0,20, by = .001)
y <- dgamma(x, 2, .5)
ggplot() +
geom_line(aes(x = x, y = y))
102/37
x <- seq(0,20, by = .001)
y <- dgamma(x, 2, .5)
ggplot() +
geom_line(aes(x = x, y = y)) +
labs(title = "Prior Distribution of $\lambda_2$")
x <- seq(0,20, by = .001)
y <- dgamma(x, 2, .5)
ggplot() +
geom_line(aes(x = x, y = y)) +
labs(title = TeX("Prior Distribution of $\lambda_2$"))
x <- seq(0,20, by = .001)
y <- dgamma(x, 2, .5)
ggplot() +
geom_line(aes(x = x, y = y)) +
labs(title = TeX("Prior Distribution of $\\lambda_2$"))
x <- seq(0,20, by = .001)
y <- dgamma(x, 2, .5)
ggplot() +
geom_line(aes(x = x, y = y)) +
labs(title = expression(paste("Prior Distribution of", lambda))
x <- seq(0,20, by = .001)
y <- dgamma(x, 2, .5)
ggplot() +
geom_line(aes(x = x, y = y)) +
labs(title = expression(paste("Prior Distribution of", lambda)))
x <- seq(0,20, by = .001)
y <- dgamma(x, 2, .5)
ggplot() +
geom_line(aes(x = x, y = y)) +
labs(title = expression(paste("Prior Distribution of ", lambda)))
x <- seq(0,20, by = .001)
y <- dgamma(x, 2, .5)
ggplot() +
geom_line(aes(x = x, y = y)) +
labs(title = expression(paste("Prior Distribution of ", lambda_2)))
x <- seq(0,20, by = .001)
y <- dgamma(x, 2, .5)
ggplot() +
geom_line(aes(x = x, y = y)) +
labs(title = expression(paste("Prior Distribution of ", lambda_{2})))
x <- seq(0,20, by = .001)
y <- dgamma(x, 2, .5)
ggplot() +
geom_line(aes(x = x, y = y)) +
labs(title = expression(paste("Prior Distribution of ", lambda[2])))
x <- seq(0,20, by = .001)
y <- dgamma(x, 2, .5)
ggplot() +
geom_line(aes(x = x, y = y)) +
labs(title = expression(paste("Prior Distribution of ", lambda[2])))
expected <- 2/.5
variance <- 2/(.5^2)
sqrt(8)
2.8*3
gamma_2 <- 2 + 102
phi_2 <- .5 + 37
lower <- qgamma(.025, gamma_2, phi_2)
upper <- qgamma(.975, gamma_2, phi_2)
h_gamma_2 <- 2 + 185
h_phi_2 <- .5 + 41
sample1 <- rgamma(10000, c_gamma_2, c_phi_2)
c_gamma_2 <- 2 + 102
c_phi_2 <- .5 + 37
h_gamma_2 <- 2 + 185
h_phi_2 <- .5 + 41
sample1 <- rgamma(10000, c_gamma_2, c_phi_2)
sample2 <- rgamma(10000, h_gamma_2, h_phi_2)
difs <- sample2 - sample1
lower <- qgamma(.025, gamma_2, phi_2)
upper <- qgamma(.975, gamma_2, phi_2)
185/41
201/37
102/37
h_gamma_2 <- 2 + 185
h_phi_2 <- .5 + 41
sample1 <- rgamma(10000, c_gamma_2, c_phi_2)
sample2 <- rgamma(10000, h_gamma_2, h_phi_2)
difs <- sample2 - sample1
lower <- quantile(difs, .025)
upper <- quantile(difs, .975)
lower
upper
sigma2 <- .821
lambda <- 6
tau2 <- 10
data <- 1244
n <- 232
lambda.post <- ((tau2*data)+(sigma2*lambda))/((tau2*n)+sigma2)
tau2.post <- (sigma2*tau2)/((tau2*n)+sigma2)
lambda.post
data/n
sd(data)
var(data)
tau2.post
x <- seq(3,6, by = .001)
y <- dnorm(x, lambda.post, tau2.post)
ggplot() +
geom_line(aes(x = x, y = y)) +
labs(title = expression(paste("Posterior Distribution of ", lambda[W])))
x <- seq(5.2,5.5, by = .001)
y <- dnorm(x, lambda.post, tau2.post)
ggplot() +
geom_line(aes(x = x, y = y)) +
labs(title = expression(paste("Posterior Distribution of ", lambda[W])))
x <- seq(5.3,5.4, by = .001)
y <- dnorm(x, lambda.post, tau2.post)
ggplot() +
geom_line(aes(x = x, y = y)) +
labs(title = expression(paste("Posterior Distribution of ", lambda[W])))
x <- seq(5.3,5.4, by = .001)
y <- dnorm(x, lambda.post, tau2.post)
ggplot() +
geom_line(aes(x = x, y = y)) +
labs(title = expression(paste("Posterior Distribution of ", mu[W])))
x <- seq(5.3,5.4, by = .001)
y <- dnorm(x, lambda.post, tau2.post)
ggplot() +
geom_line(aes(x = x, y = y)) +
labs(title = expression(paste("Posterior Distribution of ", mu[F])))
lower <- qnorm(.025, lambda.post, tau2.post)
upper <- qnorm(.975, lambda.post, tau2.post)
?Seq
?seq\
?seq
mus <- rnorm(10000, lambda.post, tau2.post)
xs <- rnorm(1, mus, seq(sigma2, by = 10000))
mus <- rnorm(10000, lambda.post, tau2.post)
xs <- rnorm(1, mus, rep(10000, sigma2))
mus <- rnorm(10000, lambda.post, tau2.post)
xs <- rnorm(1, mus, rep(sigma2, 10000))
rep(sigma2, 10000)
mus
rnorm(1, mus, rep(sigma2, 10000))
mus <- rnorm(10000, lambda.post, tau2.post)
xs <- rnorm(10000, mus, rep(sigma2, 10000))
mus <- rnorm(10000, lambda.post, tau2.post)
xs <- rnorm(10000, mus, rep(sigma2, 10000))
lower <- quantile(xs, .025)
upper <- quantile(xs, .975)
lower
upper
new_lower <- exp(lower)
new_upper <- exp(upper)
exp(3.75)
new_lower
new_upper
sigma2 <- 1.51
lambda <- 6
tau2 <- 10
data <- 403
n <- 67
lambda.post <- ((tau2*data)+(sigma2*lambda))/((tau2*n)+sigma2)
tau2.post <- (sigma2*tau2)/((tau2*n)+sigma2)
mus <- rnorm(10000, lambda.post, tau2.post)
xs <- rnorm(10000, mus, rep(sigma2, 10000))
lower <- quantile(xs, .025)
upper <- quantile(xs, .975)
new_lower <- exp(lower)
new_upper <- exp(upper)
new_lower
new_upper
403/67
1244/232
mean(xs)
sigma2 <- .821
lambda <- 6
tau2 <- 10
data <- 1244
n <- 232
lambda.post <- ((tau2*data)+(sigma2*lambda))/((tau2*n)+sigma2)
tau2.post <- (sigma2*tau2)/((tau2*n)+sigma2)
mus <- rnorm(10000, lambda.post, tau2.post)
xs <- rnorm(10000, mus, rep(sigma2, 10000))
lower <- quantile(xs, .025)
upper <- quantile(xs, .975)
mean(xs)
alpha.post <- (3*35) + .65
beta.post <- 4.35 + 192
alpha.post <- (3*35) + .65
beta.post <- 4.35 + 192
lower <- (3/qbeta(.025, alpha.post, beta.post))-3
upper <- (3/qbeta(.975, alpha.post, beta.post))-3
lower
upper
alpha.post <- (3*35) + .65
beta.post <- 4.35 + 192
samp <- rbeta(10000, alpha.post, beta.post)
alpha.post <- (3*35) + .65
beta.post <- 4.35 + 192
samp <- rbeta(10000, alpha.post, beta.post)
lower <- quantile(samp, .025)
upper <- quantile(samp, .975)
lower
upper
3/lower
3/upper
alpha.post <- (3*35) + .65
beta.post <- 4.35 + 192
samp <- rbeta(10000, alpha.post, beta.post)
(3/lower-3)
lower <- quantile(samp, .025)
upper <- quantile(samp, .975)
real_lower <- (3/upper)-3
real_upper <- (3/lower)-3
real_lower
real_upper
3/.404-3
192/35
mus <- 3/samp-3
quantile(mus, .025)
quantile(mus, .975)
# create sequence of xs and ys
x <- seq(0,20, by = .001)
y <- dgamma(x, 2, .5)
ggplot() +
geom_line(aes(x = x, y = y)) +
labs(title = expression(paste("Prior Distribution of ", lambda[2])))
# find expected value and variance of prior
expected <- 2/.5
variance <- 2/(.5^2)
(9/6)-3-(1/2)
9-18-3
12*64
1/.4
1.4*2.5
3.5*2.5
2.5*2.5
8.75+6.25
ln1
ln(1)
log(1)
?rbinom
rbinom(1,1,.3)
rbinom(1,1,.3)
rbinom(1,1,.3)
rbinom(1,1,.3)
rbinom(1,1,.3)
rbinom(5,1,.3)
rbinom(5,2,.3)
library(bonsai)
library(lightgbm)
## Load In Libraries
library(tidyverse)
library(tidymodels)
library(vroom)
library(embed) # for target encoding
test <- vroom("test.csv")
setwd("~/Documents/Stat 348/AllstateClaimsSeverity")
test <- vroom("test.csv")
train <- vroom("train.csv") %>%
mutate(loss = log(loss)) # transform to log
boost_model <- boost_tree(tree_depth=tune(),
trees=tune(),
learn_rate=tune()) %>%
set_engine("lightgbm") %>%
set_mode("classification")
boost_wf <- workflow() %>%
add_recipe(my_recipe) %>%
add_model(boost_model)
my_recipe <- recipe(loss~., data = train) %>%
step_lencode_mixed(all_nominal_predictors(), outcome = vars(loss)) %>%
step_zv(all_predictors()) %>%
step_normalize(all_numeric_predictors())# %>%
boost_wf <- workflow() %>%
add_recipe(my_recipe) %>%
add_model(boost_model)
tuning_grid <- grid_regular(tree_depth(),
trees(),
learn_rate(),
levels = 5)
# split data into folds
folds <- vfold_cv(train, v = 5, repeats = 1)
# run Cross validation
CV_results <- boost_wf %>%
tune_grid(resamples = folds,
grid = tuning_grid,
metrics = metric_set(roc_auc, accuracy))
boost_model <- boost_tree(tree_depth=tune(),
trees=tune(),
learn_rate=tune()) %>%
set_engine("lightgbm") %>%
set_mode("regression")
?predict
library(bonsai)
library(lightgbm)
boost_model <- boost_tree(tree_depth=tune(),
trees=tune(),
learn_rate=tune()) %>%
set_engine("lightgbm") %>%
set_mode("regression")
boost_wf <- workflow() %>%
add_recipe(my_recipe) %>%
add_model(boost_model)
tuning_grid <- grid_regular(tree_depth(),
trees(),
learn_rate(),
levels = 5)
# split data into folds
folds <- vfold_cv(train, v = 5, repeats = 1)
boost_model <- boost_tree(tree_depth=tune(),
trees=tune(),
learn_rate=tune()) %>%
set_engine("lightgbm") %>%
set_mode("regression")
boost_wf <- workflow() %>%
add_recipe(my_recipe) %>%
add_model(boost_model)
tuning_grid <- grid_regular(tree_depth(),
trees(),
learn_rate(),
levels = 5)
# split data into folds
folds <- vfold_cv(train, v = 5, repeats = 1)
# run Cross validation
CV_results <- boost_wf %>%
tune_grid(resamples = folds,
grid = tuning_grid,
metrics = metric_set(mae))
tuning_grid <- grid_regular(tree_depth(),
trees(),
learn_rate(),
levels = 1)
# split data into folds
folds <- vfold_cv(train, v = 5, repeats = 1)
# run Cross validation
CV_results <- boost_wf %>%
tune_grid(resamples = folds,
grid = tuning_grid,
metrics = metric_set(mae))
# split data into folds
folds <- vfold_cv(train, v = 5, repeats = 1)
# run Cross validation
CV_results <- boost_wf %>%
tune_grid(resamples = folds,
grid = tuning_grid,
metrics = metric_set(mae))
# find best parameters
bestTune <- CV_results %>%
select_best("mae")
final_boost_workflow <- boost_wf %>%
finalize_workflow(bestTune) %>%
fit(data = train)
# predict
boost_preds <- predict(final_boost_workflow,
new_data = test)
final_boost_preds <- tibble(id = test$id,
loss = exp(boost_preds$.pred_class))
boost_preds
View(boost_preds)
tuning_grid <- grid_regular(tree_depth(),
trees(),
learn_rate(),
levels = 2)
